<?xml version="1.0" encoding="UTF-8"?>

<!-- 
	mapper 파일은 특정 테이블에 대한 SQL 구문을 보관하는 파일이다
	- myBatis를 이용하는 개발자는 이곳에 저장된 SQL 구문을 "아이디"를 이용해서 호출한다
	- 파일마다 동일한 아이디로 인해 발생하는 충돌을 방지하기 위해 고유한 namespace를 사용한다
	- 만약 namespace가 olympic이고 구문 ID가 list라면 외부에서는 olympic.list로 호출한다
	- 일반적으로 namespace는 테이블명으로 한다! 
	- mapper 내부에는 다음 종류 태그로 구문을 저장할 수 있다.
		- insert
		- delete
		- update
		- select
 -->
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
	<mapper namespace="board">
		<select id = "list" parameterType="Map" resultType="BoardDto">
			select * from (
				select rownum rn, TMP.*from(
			select * from board 
			<if test = "type != null and keyword != null">
			<![CDATA[
			where instr(${type},#{keyword}) > 0
			]]>
			</if>
			connect by prior board_no =super_no
			start with super_no = 0 
			order siblings by group_no desc, board_no asc
			)TMP
			)where rn between #{begin} and #{end}
				
		</select>  
	
		<select id="count" parameterType="Map" resultType="int">
			select count(*) from board
			<if test ="type != null and keyword != null">
			<![CDATA[
			where instr(${type},#{keyword}) > 0
			]]>
			</if>
		</select>
		
		<update id = "plusReadCount" parameterType="int">
			update board
			set board_readcount = board_readcount + 1 
			where board_no = #{boardNo}
		</update>
		
		<select id = "one" parameterType="int" resultType="BoardDto">
			select * from board where board_no = #{boardNo}
		</select>
		
		<delete id = "delete" parameterType="int">
			delete board where board_no = #{boardNo}
		</delete>
		
		<update id = "edit" parameterType="BoardDto">
			update board
				set
					board_head = #{boardHead},
					board_title = #{boardTitle},
					board_content = #{boardContent}
				where
					board_no = #{boardNo}
		
		</update>
		
		<select id = "sequence" resultType="int">
			select board_seq.nextval from dual
		</select>
		
		<insert id = "write" parameterType="BoardDto">
				insert into board(
			board_no, board_head, board_title, board_content, board_writer, 
			group_no, super_no, depth
		)
		values(
			#{boardNo}, #{boardHead}, #{boardTitle}, #{boardContent}, #{boardWriter},
			#{groupNo}, #{superNo}, #{depth}		
		)
		</insert>
	</mapper> 	